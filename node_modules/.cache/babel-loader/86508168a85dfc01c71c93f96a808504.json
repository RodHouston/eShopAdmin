{"ast":null,"code":"import { useDispatch, useSelector } from \"react-redux\";\nimport { getStorage, ref, uploadBytesResumable, getDownloadURL } from \"firebase/storage\";\nimport app from \"../firebase\";\nimport { addPhotos } from \"./productRedux\";\nimport { updateProducts } from \"./apiCalls\";\nexport default function AddPhotoToFireBase(files1, mainFile, product, isMainPhoto, isExtraPhotos, dispatch) {\n  console.log('inside Add to Firebae');\n  let pho = [];\n  let mainPho = mainFile;\n  let files = new Array(files1); // console.log(isExtraPhotos);\n  // console.log(files1);\n  // console.log(isMainPhoto);\n  // console.log(mainFile);\n\n  product === null || product === void 0 ? void 0 : product.morePhotos.map((photo, idx) => {\n    if (files[0][idx] == null) {\n      pho[idx] = photo;\n      files[0][idx] = photo;\n    } else if (files[0][idx] != null) {\n      pho[idx] = files[0][idx];\n    }\n  });\n  files[0].push({\n    main: mainFile\n  });\n  console.log(files);\n  let items = [];\n  let itemsProcessed = 0;\n  let haveFiles = false;\n  let isSuccesful = false;\n  files[0].forEach((fil, idx) => {\n    let file; // console.log(idx);\n    // console.log(fil.main);\n\n    if (idx >= files[0].length - 1) {\n      console.log(\"in switch case 1\");\n      file = fil.main;\n    } else {\n      console.log(\"in case 2\");\n      file = fil;\n    }\n\n    console.log(\"after change\");\n    console.log(file);\n\n    if (typeof file == \"object\") {\n      var _file;\n\n      items.push(file);\n      haveFiles = true;\n      const fileName = (_file = file) === null || _file === void 0 ? void 0 : _file.name;\n      const storage = getStorage(app);\n      const StorageRef = ref(storage, `images/productImages/${product._id}/${fileName}`);\n      const uploadTask = uploadBytesResumable(StorageRef, file); // Register three observers:\n      // 1. 'state_changed' observer, called any time the state changes\n      // 2. Error observer, called on failure\n      // 3. Completion observer, called on successful completion\n\n      uploadTask.on('state_changed', snapshot => {\n        // Observe state change events such as progress, pause, and resume\n        // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded\n        const progress = snapshot.bytesTransferred / snapshot.totalBytes * 100;\n        console.log('Upload is ' + progress + '% done');\n\n        switch (snapshot.state) {\n          case 'paused':\n            console.log('Upload is paused');\n            break;\n\n          case 'running':\n            console.log('Upload is running');\n            break;\n\n          default:\n        }\n\n        console.log('Upload is ' + progress + '% done');\n      }, error => {\n        // Handle unsuccessful uploads\n        console.log(error);\n      }, async () => {\n        // Handle successful uploads on complete\n        // For instance, get the download URL: https://firebasestorage.googleapis.com/...\n        console.log('File available at', downloadURL); // pho.push(downloadURL)\n\n        if (idx <= files[0].length - 2) {\n          await getDownloadURL(uploadTask.snapshot.ref).then(downloadURL => {\n            console.log('in more file');\n            pho[idx] = downloadURL;\n            isSuccesful = true;\n            itemsProcessed++;\n          });\n        }\n\n        if (idx >= files[0].length - 1) {\n          await getDownloadURL(uploadTask.snapshot.ref).then(downloadURL => {\n            console.log(\"in main pho\");\n            mainPho = downloadURL;\n            isSuccesful = true;\n            itemsProcessed++;\n          });\n        }\n\n        console.log(\"hre\");\n        let pro = {};\n\n        if (itemsProcessed >= items.length - 1 && isSuccesful) {\n          if (isExtraPhotos || isMainPhoto) {\n            pro = { ...product,\n              img: mainPho,\n              morePhotos: pho\n            };\n          }\n\n          await updateProducts(pro._id, pro, dispatch);\n          console.log(\"Success, we need to REFRSH\");\n          return pro;\n        }\n      });\n    }\n  }); // if (!haveFiles) {\n  //     console.log(\"We dont have files and need to REFRSH\");        \n  // }\n\n  console.log(pho);\n}\n_c = AddPhotoToFireBase;\n\nvar _c;\n\n$RefreshReg$(_c, \"AddPhotoToFireBase\");","map":{"version":3,"sources":["/Users/roderickhouston/Desktop/GA Projects/eCommerceAdmin/src/redux/toFirebase.js"],"names":["useDispatch","useSelector","getStorage","ref","uploadBytesResumable","getDownloadURL","app","addPhotos","updateProducts","AddPhotoToFireBase","files1","mainFile","product","isMainPhoto","isExtraPhotos","dispatch","console","log","pho","mainPho","files","Array","morePhotos","map","photo","idx","push","main","items","itemsProcessed","haveFiles","isSuccesful","forEach","fil","file","length","fileName","name","storage","StorageRef","_id","uploadTask","on","snapshot","progress","bytesTransferred","totalBytes","state","error","downloadURL","then","pro","img"],"mappings":"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","sourcesContent":["\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { getStorage, ref, uploadBytesResumable, getDownloadURL } from \"firebase/storage\";\nimport app from \"../firebase\"\nimport { addPhotos } from \"./productRedux\";\nimport { updateProducts } from \"./apiCalls\";\n\nexport default function AddPhotoToFireBase(files1, mainFile, product, isMainPhoto, isExtraPhotos, dispatch) {\n    console.log('inside Add to Firebae');\n\n    let pho = []\n    let mainPho = mainFile\n    let files = new Array(files1)\n\n    // console.log(isExtraPhotos);\n    // console.log(files1);\n    // console.log(isMainPhoto);\n    // console.log(mainFile);\n\n\n    product?.morePhotos.map((photo, idx) => {\n        if (files[0][idx] == null) {\n            pho[idx] = photo\n            files[0][idx] = photo\n        } else if (files[0][idx] != null) {\n            pho[idx] = files[0][idx]\n        }\n    })\n    files[0].push({ main: mainFile })\n\n    console.log(files);\n\n    let items = []\n    let itemsProcessed = 0\n    let haveFiles = false\n    let isSuccesful = false\n\n    files[0].forEach((fil, idx) => {\n        let file;    \n        // console.log(idx);\n        // console.log(fil.main);\n\n        if (idx >= files[0].length - 1) {\n            console.log(\"in switch case 1\");\n            file = fil.main\n        } else {\n            console.log(\"in case 2\");\n            file = fil\n        }\n        console.log(\"after change\");\n        console.log(file);\n        if (typeof file == \"object\") {\n            items.push(file)\n            haveFiles = true\n\n            const fileName = file?.name;\n            const storage = getStorage(app)\n            const StorageRef = ref(storage, `images/productImages/${product._id}/${fileName}`)\n            const uploadTask = uploadBytesResumable(StorageRef, file);\n            // Register three observers:\n            // 1. 'state_changed' observer, called any time the state changes\n            // 2. Error observer, called on failure\n            // 3. Completion observer, called on successful completion\n            uploadTask.on('state_changed', (snapshot) => {\n                // Observe state change events such as progress, pause, and resume\n                // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded\n                const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\n                console.log('Upload is ' + progress + '% done');\n                switch (snapshot.state) {\n                    case 'paused':\n                        console.log('Upload is paused');\n                        break;\n                    case 'running':\n                        console.log('Upload is running');\n                        break;\n                    default:\n                }\n                console.log('Upload is ' + progress + '% done');\n            },\n                (error) => {\n                    // Handle unsuccessful uploads\n                    console.log(error);\n                },\n                async () => {\n                    // Handle successful uploads on complete\n                    // For instance, get the download URL: https://firebasestorage.googleapis.com/...\n                    \n                        console.log('File available at', downloadURL);\n                        // pho.push(downloadURL)\n                        if (idx <= files[0].length - 2) {\n                            await getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {\n                            console.log('in more file');\n                            pho[idx] = downloadURL\n                            isSuccesful = true\n                            itemsProcessed++\n                        });\n                        }\n                        if (idx >= files[0].length - 1) {\n                            await getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {\n                            console.log(\"in main pho\");\n                            mainPho = downloadURL\n                            isSuccesful = true\n                            itemsProcessed++\n                        });\n                        }                        \n                    \n                    console.log(\"hre\");\n                        let pro = {};\n                        if (itemsProcessed >= items.length - 1 && isSuccesful) {\n                            if (isExtraPhotos || isMainPhoto) {\n                                pro = { ...product, img: mainPho, morePhotos: pho }\n                            }\n                            await updateProducts(pro._id, pro, dispatch)\n                            console.log(\"Success, we need to REFRSH\");\n                            return pro;\n                        }\n                    \n                });\n        }\n\n    })\n\n\n\n\n\n\n    // if (!haveFiles) {\n    //     console.log(\"We dont have files and need to REFRSH\");        \n    // }\n    console.log(pho);\n\n}\n"]},"metadata":{},"sourceType":"module"}